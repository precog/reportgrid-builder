define(["util/dom","lib/jquery-pnotify/jquery.pnotify"],function(e){function i(e){return e}function o(e,t,n){for(var r=0;r<n.length;r++)"undefined"!=typeof e[n[r].src]&&(t[n[r].dst]=n[r].handler(e[n[r].src]))}var t=5e3,n=2500,r=1e4,s=[{src:"text",dst:"text",handler:i},{src:"type",dst:"type",handler:i},{src:"icon",dst:"notice_icon",handler:function(e){return"ui-icon "+e}},{src:"timeout",dst:"delay",handler:i},{src:"hide",dst:"hide",handler:i},{src:"before_open",dst:"before_open",handler:i},{src:"before_close",dst:"before_close",handler:i},{src:"after_open",dst:"after_open",handler:i},{src:"after_close",dst:"after_close",handler:i},{src:"history",dst:"history",handler:i},{src:"sticker",dst:"sticker",handler:i},{src:"width",dst:"width",handler:i},{src:"min_height",dst:"min_height",handler:i},{src:"opacity",dst:"opacity",handler:i},{src:"stack",dst:"stack",handler:i},{src:"shadow",dst:"shadow",handler:i}];return{success:function(e,n){n=n||{};var r={title:e,shadow:!0,delay:t,sticker:!1,insert_brs:!1,styling:"jqueryui",title_escape:!1,text_escape:!1};return o(n,r,s),r.text||(r.text=""),r.text+='\n<div class="pg-clear"></div>',$.pnotify(r)},context:function(e,t){t=t||{},t.voffset=t.voffset||25,t.width=t.width||"420px";var n=this.tip(e,t);return n.mouseenter(function(){var e=!1;$("select").click(function(t){e=!e,t.stopPropagation()}),$("body").click(function(){e&&(e=!1)}),n.mouseleave(function(){e||n.remove()})}),n},copier:function(t,n){n=n||{};var r=navigator.userAgent.indexOf("Mac OS X")!=-1?"CMD+C":"CTRL+C";n.text='<div class="pg-message">'+n.text+'</div><div class="pg-textarea"><textarea>'+n.copy+'</textarea></div><div class="pg-footer">'+r+" to copy the link</div>";var i=this.context(t,n),s=i.find("textarea");return s.click(function(){e.selectText(s.get(0))}),setTimeout(function(){e.selectText(s.get(0))},500),i},tip:function(e,t){function i(){var e=$(n).offset(),i=$(n).outerWidth(),s=r.outerWidth(),o=(i-s)/2+e.left;o<t.hoffset?o=t.hoffset:o+s+t.hoffset>$(window).width()&&(o=$(window).width()-t.hoffset-s),r.css({left:o+"px",top:e.top+t.voffset+"px"})}function s(){$(window).off("resize",i)}t=t||{},t.history=!1,t.sticker=!1,t.hide=!1,t.stack=!1,t.shadow=!0,t.type=t.type||"info",t.opacity=.95,t.voffset=t.voffset||40,t.hoffset=t.hoffset||10;var n=t.target||document.body,r=this.success(e,t);$(window).on("resize",i);var o=t.before_close;return t.before_close=function(e){console.log(o),o&&o.apply(this,e),s(this,e)},setTimeout(i,0),r},main:function(e,t){function i(){var e=$(window).width(),t=$(window).height(),n=r.outerWidth(),i=r.outerHeight();r.css({left:(e-n)/2+"px",top:(t-i)/2+"px"})}function s(){$(window).off("resize",i)}t=t||{},t.history=!1,t.sticker=!1,t.width="500px",t.min_height||(t.min_height="300px"),t.hide=!1,t.stack=!1,t.shadow=!0,t.type="info",t.opacity=.95;var n=t.before_close;t.before_close=function(e){n&&n.apply(this,e),s(this,e)};var r=this.success(e,t);return $(window).on("resize",i),setTimeout(i,0),r},quick:function(e,t){return t=t||{},t.timeout=n,this.success(e,t)},progress:function(e,t){var n=1,i,s,o,u=t.text||"",a;return t.hide=!1,t.text='<div class="pg-message">'+u+'</div><div class="pg-progress-bar"></div>',t.before_open=function(e){i=e,s=e.find("div.pg-progress-bar"),o=e.find("div.pg-message")},t.progressStart=function(e){clearInterval(a),i.show(),o.removeClass("ui-state-error"),o.html(e),s.show(),s.progressbar({value:0})},t.progressStep=function(e){var t=e*100;t>100&&(t=100),s.progressbar({value:t})},t.progressComplete=function(e){o.html(e),s.hide(),a=setTimeout(function(){i.hide()},r)},t.progressError=function(e){s.hide(),o.addClass("ui-state-error").html(e),a=setTimeout(function(){i.hide()},r)},t.el=this.success(e,t)}}})