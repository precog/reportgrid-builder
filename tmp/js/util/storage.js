define(["util/traverse","lib/jquery-jstorage/jstorage"],function(e){return function(t,n){function s(){$.jStorage.set(t,i),r=!1}function o(){a&&console.log("Load Storage Data"),$.jStorage.reInit();var e=$.jStorage.get(t);$.extend(i,e)}function f(e,t,n){if(!a)return;var r="undefined"!=typeof n&&JSON.stringify(n)||"",i=100,s="...";r.length>i-s.length&&(r=r.substr(0,i-s.length)+s),console.log((e&&e+" "||"")+t+(r&&": "+r||""))}var r=!1,i=$.extend({},n),u=function(){r=!0,clearInterval(this.killDelayedSave),this.killDelayedSave=setTimeout(function(){s()},100)};o();var a=!1,l={get:function(t,n){var r=e.get(i,t);return f("get",t,r),"undefined"==typeof r?n:r},set:function(t,n,r){e.set(i,t,n)&&(f("set",t,n),this.save(r))},remove:function(t,n){f("del",t),e.remove(i,t),this.save(n)},keys:function(t){var n=e.get(i,t);if(n&&"object"==typeof n){var r=[];for(var s in n)n.hasOwnProperty(s)&&r.push(s);return r}return[]},save:function(e){e?s():u()},load:function(){o()},clear:function(){$.jStorage.flush()},toString:function(){return JSON.stringify(i)},all:function(){return i},dirty:function(){return r}};return l}})