define(["jquery","util/dom","util/notification","util/widget/menu","lib/jquery-ui/jquery.ui"],function(e,t,n){var r,i=0;return e.fn.outerHTML=function(){return this.length?this[0].outerHTML||function(e){var t=document.createElement("div");t.appendChild(e.cloneNode(!0));var n=t.innerHTML;return t=null,n}(this[0]):this},r={clickOrDoubleClick:function(e,t,n){var r=0;e.click(function(e){r++,r===1?setTimeout(function(){if(r!==1){r=0;return}r=0,t.call(this,e)},200):(r=0,n.call(this,e))})},button:function(t,n){t=e(t),n=e.extend({disabled:!1,label:"",text:!1,handler:function(){},icons:null},n);var i={disabled:n.disabled,text:n.text,label:n.label,icons:n.icon?{primary:n.icon}:n.icons};i.icons||delete i.icons;var s=t.append("<button></button>").find("button:last").button(i).click(function(e){return n.handler.apply(s.get(0)),e.preventDefault(),!1});return n.description&&r.tooltip(s,n.description),s},menu:function(t,n){t=e(t),n=e.extend({disabled:!1},n);var r=t.menu({disabled:n.disabled});return r.find("ul").addClass("ui-menu"),r},contextmenu:function(t,n){t=e(t),t.addClass("context-menu"),e("body").append(t);var r=this.menu(t,n),i=r.show;return r.show=function(){e("body").one("click",function(){r.hide()}),i.apply(r,arguments)},r},tabs:function(t,n){return t=e(t),t.tabs(n)},radios:function(t,n){var s;t=e(t),n&&(t.find("*").remove(),i++,e(n).each(function(o,u){var a=u.group,f="pg-buttonset-"+i+"-"+o,l=u.label;u.btn=t.append('<input type="radio" id="'+f+'" name="'+a+'" '+(u.checked?'checked="checked" ':"")+'/><label for="'+f+'">'+l+"</label>").find("#"+f),u.btn.click(function(){e(n).each(function(e,t){t.checked=t.token===u.token}),u.handler(u)}),u.checked&&(s=u.btn),u.description&&r.tooltip(btn,u.description)}));var o=t.buttonset();return s&&setTimeout(function(){s.click()},100),o},checks:function(t,n){return t=e(t),n&&(t.find("*").remove(),i++,e(n).each(function(e,n){var s=n.name||"",o=n.checked||!1,u="pg-buttonset-"+i+"-"+e,a=n.label,f=t.append('<input type="checkbox" id="'+u+'" name="'+s+'" '+(o?'checked="checked" ':"")+'/><label for="'+u+'">'+a+"</label>").find("#"+u);f.click(function(e){n.checked=!!f.attr("checked"),n.handler&&n.handler.call(f,e,n)}),n.description&&r.tooltip(f,n.description)})),t.buttonset()},buttonset:function(t){return t=e(t),t.buttonset()},progressbar:function(t){return t=e(t),t.progressbar()},tooltip:function(t,n){var r="function"==typeof n?n:function(){return n};return e(t).attr("title",r.apply(e(t),[])),t},edit:function(r,i){function f(){a&&a.remove(),r.html(o),i.cancel()}r=e(r),i=e.extend({handler:function(e){return null},cancel:function(){}},i);var s=i.text||r.text().trim(),o=r.html(),u=r.html('<input type="text" name="pg-editable" id="pg-editable" value="'+s+'" />').find("#pg-editable"),a;e(document.body).one("mousedown",function(){f()}),u.change(function(){var e=u.val();if(e===s)return f();i.handler(e,function(t){a&&a.remove();if(t){a=n.tip("invalid value",{target:r,text:t,type:"error"});return}r.html(e)})}).keyup(function(e){switch(e.which){case 9:case 13:u.trigger("change");break;case 27:f()}}),u.focus();var l=r.get(0);t.canSelect(l)||(l=u.get(0)),t.selectText(l,0,s.length)}}})